from PyQt5.QtWidgets import QMainWindow, QApplication,QTableWidgetItem
import sys
import psycopg2


from TelaInicial_ui import *
from TelaBuscarLivros_ui import *
from TelaAddLivro import *


conexao = psycopg2.connect(host='localhost',
                                                database='Biblioteca',
                                                user='postgres',
                                                password='postgres')


class AddLivros(QMainWindow,Ui_TelaAddLivros) :
    def __init__(self,parent = None):   
        super().__init__(parent)
        super().setupUi(self)
        

class BuscarLivros(QMainWindow,Ui_pesquisalivros) :
    def __init__(self,parent = None):
        super().__init__(parent)
        super().setupUi(self)
        self.BtnBuscarLivros.clicked.connect(self.buscarLivros)
        
    def buscarLivros(self):
        cursor = conexao.cursor()
        cursor.execute(f"SELECT id_livros,livro,autor,preco \
                                FROM Livros \
                                WHERE inativo =False\
                                ORDER BY id_livros ASC")
        dadoslistados = cursor.fetchall()
        
        self.tblBuscalivros.clearContents()
        self.tblBuscalivros.setRowCount(len(dadoslistados))
        
        for linha, texto in enumerate(dadoslistados):
            for coluna, data in enumerate(texto):
                self.tblBuscalivros.setItem(linha,coluna,QTableWidgetItem(str(data)))

class TelaInicial(QMainWindow,Ui_TelaPrinciapal) :
    def __init__(self,parent = None):
        super().__init__(parent)
        self.ui = Ui_TelaPrinciapal()
        self.ui.setupUi(self)
        self.ui.btnpesquisar.clicked.connect(self.entrar_telaBusacarLivros)
        self.ui.btnADDLivros.clicked.connect(self.entrar_addLivros)
        
    def entrar_telaBusacarLivros(self):
        self.tela=BuscarLivros()
        self.tela.show()
        
    def entrar_addLivros(self):
        self.tela=AddLivros()
        self.tela.show()

if __name__ == '__main__':
    qt = QApplication(sys.argv)
    telainicial = TelaInicial()
    telainicial.show()
    qt.exec_()
    
